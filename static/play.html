<!DOCTYPE "html">
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="css/play.css" />
    <script src="js/angular.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/jcanvas.min.js"></script>
    <script src="js/gameloop.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/pause.js"></script>
    <script src="js/skyfall.js"></script>
    <script src="js/gamescreen.js"></script>
    <script src="js/singlekeyscreen.js"></script>
    <script src="js/kblayout.js"></script>
    <script src="js/keystats.js"></script>
    <script src="js/raphael-min.js"></script>
    <script src="js/kbsvg.js"></script>
    <script>
      $(function() {
        "strict";

        var layout = new KeyboardLayout(KeyboardLayout.LAYOUT.ansi_qwerty);

        function startGame() {
          function showKeyboardStats(parent, layout, kbstats, modifier) {
            function formatRGB(rgb) {
              return 'rgb(' + rgb.join(',') + ')';
            }
            modifier = modifier || 'none';
            new KeyboardSVG(parent, layout, function(p) {
              var ch = p[modifier];
              var fontColor = 'black';
              var text = ch;
              if (text == null) {
                text = p.nonchar;
              }
              switch (text) {
                case 'tab': text = '\u21e5'; break;
                case 'enter': text = '\u23ce'; break;
                case 'backspace': text = '\u232b'; break;
                case 'capslock': text = '\u21ea'; break;
                case 'shift': text = '\u21e7'; break;
                case 'space': text = '\u2423'; break;
              }
              if (p.nonchar && p.nonchar === modifier) {
                p.path.attr('fill', 'gray');
                fontColor = 'white';
              } else if (ch in kbstats.keys) {
                p.path.attr('fill', formatRGB(kbstats.heatRGBForChar(ch)));
                fontColor = 'white';
              }

              if (text != null) {
                var bbox = p.path.getBBox();
                var text = p.path.paper.text(bbox.x + bbox.width / 2, bbox.y + bbox.height / 2, text)
                .attr({
                  'font-size': '15pt',
                  'fill': fontColor,
                  'font-family': 'Arial,Helvetica,sans-serif',
                  'font-weight': 'normal',
                });
              }
            });
          }

          var keySet = layout.query('');

          function makeSkyFall(parent, config) {
            return new SkyFall(parent, function() {
              var r = Math.floor(Math.random() * keySet.length);
              return keySet[r];
            }, config);
          }

          var gameParent = $('#game-container');

          gameParent.empty();
          var gs = new SingleKeyGameScreen(gameParent, makeSkyFall, {
            num: 1,
            countdownSeconds: 0,
            onstop: function() {
              showKeyboardStats(gs.noneDiv, layout, gs.stats, 'none');
              showKeyboardStats(gs.shiftDiv, layout, gs.stats, 'shift');
            },
          });

          gs.start();
        }

        function showContainer(name) {
          $('.content-container').hide();
          if (name != null) {
            $('#' + name + '-container').show();
          }
        }

        showContainer('game');
        startGame();
      });
    </script>
    <style>
      /* Initial style - don't show anything. */
      div.content-container {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="main">
      <div id="game-container" class="content-container">
      </div>
      <div id="title-container" class="content-container">
        <div style="padding: 2em; font-size: 3em;">
          <p>EntroType</p>
          <ul class="none">
            <li>Missions</li>
            <li>Free Play</li>
          </ul>
        </div>
      </div>
      <div id="difficulty-container" class="content-container">
        <p>Select Difficulty</p>
        <ul class="none">
          <li>Easy</li>
          <li>Medium</li>
          <li>Hard</li>
        </ul>
      </div>
    </div>
  </body>
</html>

